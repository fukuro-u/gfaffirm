window.GFAFFIRM=null,function($){window.GFAFFIRM=function(b){for(var c in b)b.hasOwnProperty(c)&&(this[c]=b[c]);this.form=null,this.countryCode="",this.paymentMethod="",this.activeFeed=null,this.feedActivated=!1,this.strings=gforms_affirm_frontend_strings,this.hasAppleCoupon=!1,this.total=0;var a=this;a.init=function(){a.form="#gform_"+a.formId,a.GFCCField="#field_"+a.formId+"_"+a.ccFieldId,a.affirmButtons=$("#gform_affirm_smart_payment_buttons"),a.orderIdField=$("#gf_affirm_order_id"),a.checkoutTokenField=$("#gf_affirm_checkout_token"),a.totalName="gform_affirm_amount_"+a.formId,a.btnArgs=null,a.bindFrontendFeedsEvaluated(),a.bindFormTotalUpdate(),$(a.form).on("submit",function(){a.isGoPrevPage()&&a.removeIdFields()}),gformCalculateTotalPrice(a.formId),a.bindAffirmRemove(),a.checkout()},a.countObj=function(a){if("function"==typeof Object.keys)return Object.keys(a).length;var b,c=0;for(b in a)a.hasOwnProperty(b)&&c++;return c},a.bindFormTotalUpdate=function(){gform.addFilter("gform_product_total",function(b,c){return"0"===c||(void 0!==window[a.totalName]&&window[a.totalName]!==b&&a.removeIdFields(),a.total=window[a.totalName]=b,a.renderAffirmField()),b},51)},a.canShowSmartButtons=function(){return"show"===gf_check_field_rule(a.formId,0)&&"show"===gf_check_field_rule(a.formId,a.ccFieldId)&&a.feedActivated&&window[a.totalName]&&"Affirm Checkout"===a.paymentMethod&&a.isLastPage()},a.isLastPage=function(){var b=$("#gform_target_page_number_"+a.formId);return!(b.length>0)||"0"===b.val()},a.isGoPrevPage=function(){var c=parseInt($("#gform_source_page_number_"+a.formId).val(),10),b=parseInt($("#gform_target_page_number_"+a.formId).val(),10);return c>b&&0!==b},a.bindSpinnerTargetElem=function(){gform.addFilter("gform_spinner_target_elem",function(b){return $("#gform_wrapper_"+a.formId+" .gform_next_button, #gform_send_resume_link_button_"+a.formId+", #gform_affirm_smart_payment_buttons")})},a.renderAffirmField=function(){"Credit Card"!==a.paymentMethod&&a.renderAffirmButtons()},a.renderAffirmButtons=function(){if(!a.canShowSmartButtons()){a.toggleAffirmButtons("none"),a.toggleSubmitButton("visible");return}a.toggleSubmitButton("hidden"),a.toggleAffirmButtons("block"),a.affirmButtons.is(":visible")&&a.bindSpinnerTargetElem()},a.checkout=function(){a.affirmButtons.on("click",function(b){if(!a.feedActivated||"1"===$("#gform_save_"+a.formId).val()||$(a.form).data("gfaffirmsubmitting")||window[a.totalName]<=0||a.isGoPrevPage()||"undefined"!=typeof gformIsRecaptchaPending&&gformIsRecaptchaPending($(a.form)))return!0;b.preventDefault(),$(a.form).addClass("no-event"),gformAddSpinner(a.formId),$(a.form).data("gfaffirmsubmitting")||$(a.form).data("gfaffirmsubmitting",!0),a.getOrderData()})},a.process_checkout=function(){var b={};for(var c in a.activeFeed)if(a.activeFeed.hasOwnProperty(c)){if("paymentAmount"==c)continue;if("feedId"==c||"feedName"==c||"no_shipping"==c||"intent"==c){b[c]=a.activeFeed[c];continue}b[c]=$("#input_"+a.formId+"_"+a.activeFeed[c]).val(),void 0===b[c]&&(b[c]=$('input[name="input_'+a.activeFeed[c]+'"]').val()),void 0===b[c]&&(b[c]=$("#input_"+a.formId+"_"+String(a.activeFeed[c]).replace(".","_")).val()),void 0===b[c]&&(b[c]=a.activeFeed[c])}window.affirm_object=a.affirm_object={merchant:{user_confirmation_url:window.location.href,user_cancel_url:window.location.href,user_confirmation_url_action:"POST",name:b.feedName},shipping:{name:{first:b.first_name,last:b.last_name},address:{line1:b.address_line1,line2:b.address_line2,city:b.address_city,state:b.address_state,zipcode:b.address_zip,country:b.address_country},phone_number:b.phone,email:b.email},billing:{name:{first:b.first_name,last:b.last_name},address:{line1:b.address_line1,line2:b.address_line2,city:b.address_city,state:b.address_state,zipcode:b.address_zip,country:b.address_country},phone_number:b.phone,email:b.email},items:a.items,discounts:a.discounts,metadata:{mode:"modal"},order_id:a.create_order_nonce,currency:a.currency,shipping_amount:a.shipping,total:100*a.total},affirm.checkout(a.affirm_object),affirm.checkout.open({onFail:function(){console.log("User cancelled the Affirm checkout flow.")},onSuccess:function(b){console.log("Affirm checkout successful."),$(a.form).append($('<input type="hidden" id="gf_affirm_order_id" name="affirm_order_id" />').val(a.create_order_nonce)),$(a.form).append($('<input type="hidden" id="gf_affirm_checkout_token" name="affirm_checkout_token" />').val(b.checkout_token)),a.affirmButtons.bind("click",function(){return!1}),$(a.form).submit()},onOpen:function(a){console.log("Affirm modal was opened successfully.")}})},a.getOrderData=function(){a.items=[],a.itemTotal=a.shipping=0,$.ajax({async:!1,url:a.strings.ajaxurl,dataType:"json",method:"POST",data:{action:"gfaffirm_get_order_data",nonce:a.get_order_nonce,form_id:a.formId,feed_id:a.activeFeed.feedId,data:$(a.form).serialize()},success:function(b){b.success&&(a.items=b.data.items,a.discounts=b.data.discounts,a.itemTotal=b.data.itemTotal,"form_total"!==a.activeFeed.paymentAmount&&(window[a.totalName]=a.total=a.itemTotal),a.shipping=b.data.shipping,a.process_checkout())},error:function(b,c){console.log(b+"\n"+c),$(a.form).data("gfaffirmsubmitting")&&($(a.form).removeClass("no-event"),a.affirmInit(),$(a.form).data("gfaffirmsubmitting",!1),a.hideFormSpinner())}})},a.bindAffirmRemove=function(){$(document).bind("DOMNodeRemoved",".affirm-sandbox-container",function(b){$(b.target).hasClass("affirm-sandbox-container")&&$(a.form).data("gfaffirmsubmitting")&&($(a.form).removeClass("no-event"),a.affirmInit(),$(a.form).data("gfaffirmsubmitting",!1),a.hideFormSpinner())})},a.affirmInit=function(){!function(j,g,k,d,a,e,l,c){var b=j[k]||{},h=document.createElement(e),m=document.getElementsByTagName(e)[0],i=function(a,b,c){return function(){a[b]._.push([c,arguments])}};b[d]=i(b,d,"set");var f=b[d];for(b[a]={},b[a]._=[],f._=[],b._=[],b[a][l]=i(b,a,l),b[c]=function(){b._.push([l,arguments])},a=0,c="set add save post open empty reset on off trigger ready setProduct".split(" ");a<c.length;a++)f[c[a]]=i(b,d,c[a]);for(a=0,c=["get","token","url","items"];a<c.length;a++)f[c[a]]=function(){};h.async=!0,h.src=g[e],m.parentNode.insertBefore(h,m),delete g[e],f(g),j[k]=b}(window,_affirm_config={public_api_key:a.public_key,script:a.affirm_src},"affirm","checkout","ui","script","ready","jsReady")},a.hideFormSpinner=function(){$("#gform_ajax_spinner_"+a.formId).length>0&&$(".gform_ajax_spinner").remove()},a.toggleSubmitButton=function(b){var c=$("#gform_submit_button_"+a.formId);c.css("visibility",b),"hidden"===b?c.addClass("canshowbuttonstatus-"+b):c.removeClass("canshowbuttonstatus-hidden")},a.toggleAffirmButtons=function(b){a.affirmButtons.css("display",b)},a.bindFrontendFeedsEvaluated=function(){gform.addAction("gform_frontend_feeds_evaluated",function(c,d){if(d===a.formId){a.feedActivated=!1;var b=a.getFirstActiveAffirmFeed(c);!1!==b&&(a.feedActivated=!0,a.loadActiveFeedSettings(b),a.renderPaymentMethod())}})},a.loadActiveFeedSettings=function(c){a.activeFeed=null;for(var b=0;b<a.countObj(a.feeds);b++)if(a.feeds[b].feedId===c.feedId)return a.activeFeed=a.feeds[b],a.activeFeed;return!1},a.renderPaymentMethod=function(){var b=$(".gform_affirm_payment_method select"),c=a.countObj(a.paymentMethods)>1&&b.size()?b.val():a.paymentMethods[0];a.displayPaymentMethod(c)},a.displayPaymentMethod=function(b){a.feedActivated?"string"==typeof b?a.paymentMethod=b:(b.hasOwnProperty("target")&&(a.removeIdFields(),b=$(b.target)),a.paymentMethod=b.val()):a.paymentMethod="",a.renderAffirmField()},a.getFirstActiveAffirmFeed=function(b){var a=b.filter(function(a){return"gfaffirm"===a.addonSlug&&a.isActivated});return!!a.length&&a.shift()},a.removeIdFields=function(){a.orderIdField.remove(),a.checkoutTokenField.remove()},a.init()}}(jQuery)